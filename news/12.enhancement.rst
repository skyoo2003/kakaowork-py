Add unit tests and improve code quality
